<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OOStuBS - Technische Informatik II (TI-II): src/internal/boot.S Quellcode</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OOStuBS - Technische Informatik II (TI-II)
   &#160;<span id="projectnumber">2.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Erzeugt von Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Hauptseite</span></a></li>
      <li><a href="pages.html"><span>Zusätzliche&#160;Informationen</span></a></li>
      <li><a href="annotated.html"><span>Klassen</span></a></li>
      <li class="current"><a href="files.html"><span>Dateien</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Auflistung&#160;der&#160;Dateien</span></a></li>
      <li><a href="globals.html"><span>Datei-Elemente</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">src/internal/boot.S</div>  </div>
</div><!--header-->
<div class="contents">
<a href="boot_8S.html">gehe zur Dokumentation dieser Datei</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\</span>
<a name="l00002"></a>00002 <span class="comment"> *                                 Technische Informatik II                                      *</span>
<a name="l00003"></a>00003 <span class="comment"> * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>
<a name="l00004"></a>00004 <span class="comment"> *                                                                                               *</span>
<a name="l00005"></a>00005 <span class="comment"> *                                        B O O T                                                *</span>
<a name="l00006"></a>00006 <span class="comment"> *                                                                                               *</span>
<a name="l00007"></a>00007 <span class="comment">\* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">/* Tell includes, that this is an assembly file */</span>
<a name="l00010"></a><a class="code" href="boot_8S.html#aa4490105d639938ba5c00b4e9e647e27">00010</a> <span class="preprocessor">#define ASM 1</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="multiboot_8h.html">machine/multiboot.h</a>&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;<a class="code" href="config_8h.html" title="verschiedene defines für Einstellungen">config.h</a>&gt;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 .text                   <span class="comment">/* The fallowing is code */</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017   
<a name="l00018"></a>00018 .globl  entry           <span class="comment">/* Define the entry point for the bootloader to be exported */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 .macro  wrapperGen      <span class="comment">/* Assembler macro to create interrupt wrapper  */</span>
<a name="l00022"></a>00022   .ifeq \@              <span class="comment">/* \@ is an automatically incremented variable, */</span>
<a name="l00023"></a>00023     <a class="code" href="boot_8S.html#ab59b207d7128ace888297774731b86d3">INT_WRAPPER_START</a>:  <span class="comment">/* it is incremented, everytime the macro   */</span>
<a name="l00024"></a>00024   .endif                <span class="comment">/* is expanded.                 */</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026   int_wrapper_\@:
<a name="l00027"></a>00027   push %<a class="code" href="boot_8S.html#a81cc0d72065afb3131a4f613d9bb9b12">eax</a>
<a name="l00028"></a><a class="code" href="boot_8S.html#a309bf8d094cdf04e19838b37c5f2f981">00028</a>   <a class="code" href="boot_8S.html#ae8831afb134363de048745378706f178">mov</a> $\@, %<a class="code" href="boot_8S.html#a81cc0d72065afb3131a4f613d9bb9b12">eax</a>
<a name="l00029"></a>00029   jmp callGuardian
<a name="l00030"></a>00030   
<a name="l00031"></a>00031   .ifeq \@
<a name="l00032"></a>00032     <a class="code" href="boot_8S.html#ae4045f33f677b81f6047a39fc9053e71">INT_WRAPPER_END</a>:
<a name="l00033"></a>00033   .endif
<a name="l00034"></a>00034 .endm
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 .align  4               <span class="comment">/* The Multiboot header must be aligned to 32bit */</span>
<a name="l00037"></a>00037      
<a name="l00038"></a>00038 multiboot_header:
<a name="l00039"></a>00039     .long   <a class="code" href="multiboot_8h.html#ab36ad4b4a42c58aac4ad1f2ba13054e9" title="spezielle (&quot;magische&quot;) Zahl, um den Multiboot-Kopf zu identifizieren">MULTIBOOT_HEADER_MAGIC</a>
<a name="l00040"></a>00040     .long   <a class="code" href="multiboot_8h.html#a5447ae8b3b45c8ed17ad61c267250992" title="Flag für alles andere als ELF-Dateien (PE-Datei, a.out, ...) zur Angabe bei Multiboot.">MULTIBOOT_HEADER_FLAGS</a>
<a name="l00041"></a>00041     .long   -(<a class="code" href="multiboot_8h.html#ab36ad4b4a42c58aac4ad1f2ba13054e9" title="spezielle (&quot;magische&quot;) Zahl, um den Multiboot-Kopf zu identifizieren">MULTIBOOT_HEADER_MAGIC</a> + <a class="code" href="multiboot_8h.html#a5447ae8b3b45c8ed17ad61c267250992" title="Flag für alles andere als ELF-Dateien (PE-Datei, a.out, ...) zur Angabe bei Multiboot.">MULTIBOOT_HEADER_FLAGS</a>)
<a name="l00042"></a>00042 #ifndef __ELF__
<a name="l00043"></a>00043     .<span class="keywordtype">long</span>   multiboot_header
<a name="l00044"></a>00044     .<span class="keywordtype">long</span>   _start
<a name="l00045"></a>00045     .<span class="keywordtype">long</span>   _edata
<a name="l00046"></a>00046     .<span class="keywordtype">long</span>   _end
<a name="l00047"></a>00047     .<span class="keywordtype">long</span>   entry
<a name="l00048"></a>00048 #endif
<a name="l00049"></a>00049      
<a name="l00050"></a>00050 entry:                  <span class="comment">/* Entry point of the system */</span>
<a name="l00051"></a>00051    cli
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 gdtSetup:               <span class="comment">/* Initialize the GDT */</span>
<a name="l00054"></a>00054    lgdt GDTR            <span class="comment">/* Load the static GDT */</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056    <a class="code" href="boot_8S.html#ae8831afb134363de048745378706f178">mov</a>  $0x10, %<a class="code" href="boot_8S.html#abb847124ab91c84675cf45ea5d858807">cx</a>      <span class="comment">/* Setting the segment selectors*/</span>
<a name="l00057"></a>00057    <a class="code" href="boot_8S.html#ae8831afb134363de048745378706f178">mov</a>  %<a class="code" href="boot_8S.html#abb847124ab91c84675cf45ea5d858807">cx</a>, %ss        <span class="comment">/* stack is data*/</span>
<a name="l00058"></a>00058    <a class="code" href="boot_8S.html#ae8831afb134363de048745378706f178">mov</a>  %<a class="code" href="boot_8S.html#abb847124ab91c84675cf45ea5d858807">cx</a>, %ds    
<a name="l00059"></a>00059    <a class="code" href="boot_8S.html#ae8831afb134363de048745378706f178">mov</a>  %<a class="code" href="boot_8S.html#abb847124ab91c84675cf45ea5d858807">cx</a>, %es
<a name="l00060"></a>00060    <a class="code" href="boot_8S.html#ae8831afb134363de048745378706f178">mov</a>  %<a class="code" href="boot_8S.html#abb847124ab91c84675cf45ea5d858807">cx</a>, %gs
<a name="l00061"></a>00061    <a class="code" href="boot_8S.html#ae8831afb134363de048745378706f178">mov</a>  %<a class="code" href="boot_8S.html#abb847124ab91c84675cf45ea5d858807">cx</a>, %fs
<a name="l00062"></a>00062    <a class="code" href="boot_8S.html#acfa959174e457286ef1afd932bdbef60">ljmpl</a> $0x08, $stackSetup   <span class="comment">/* set cs register to 0x08 */</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <a class="code" href="boot_8S.html#a309bf8d094cdf04e19838b37c5f2f981">stackSetup</a>:             <span class="comment">/*Creating a stack*/</span>
<a name="l00065"></a>00065    <a class="code" href="boot_8S.html#ae8831afb134363de048745378706f178">mov</a>  $(stack + <a class="code" href="config_8h.html#ab84fd5359aa475aeef51323866ef5d73" title="Größe für den Stack, die der Bootcode anlegen und nutzen soll.">BOOT_STACK_SIZE</a>), %esp
<a name="l00066"></a>00066   
<a name="l00067"></a>00067 <a class="code" href="boot_8S.html#adb57c81c2c1827e06a7015cc230f8aae">multibootSetup</a>:         <span class="comment">/* Passing multiboot arguments to kernel */</span>
<a name="l00068"></a>00068    pushl  %<a class="code" href="boot_8S.html#af8c3dad903dc5ce31f1b569dc396f91a">ebx</a>      
<a name="l00069"></a>00069    pushl  %<a class="code" href="boot_8S.html#a81cc0d72065afb3131a4f613d9bb9b12">eax</a>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 idtSetup:
<a name="l00072"></a>00072   <a class="code" href="boot_8S.html#ae8831afb134363de048745378706f178">mov</a> $initialIDT, %<a class="code" href="boot_8S.html#a81cc0d72065afb3131a4f613d9bb9b12">eax</a> <span class="comment">/* Load the base address of the IDT template */</span>
<a name="l00073"></a>00073   <a class="code" href="boot_8S.html#ae8831afb134363de048745378706f178">mov</a> $256, %dx         <span class="comment">/* There are 256 possible interrupts */</span>
<a name="l00074"></a>00074   <a class="code" href="boot_8S.html#aed0edaf7a9f9542fe8d84e5217620080">movl</a>  $(int_wrapper_0-<a class="code" href="boot_8S.html#ae4045f33f677b81f6047a39fc9053e71">INT_WRAPPER_END</a>+<a class="code" href="boot_8S.html#ab59b207d7128ace888297774731b86d3">INT_WRAPPER_START</a>), %<a class="code" href="boot_8S.html#af8c3dad903dc5ce31f1b569dc396f91a">ebx</a>  <span class="comment">/* Load base address of the wrapper function */</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 .<a class="code" href="boot_8S.html#a2d3583e547158b12cf139920c005272c">loop</a>:
<a name="l00077"></a><a class="code" href="boot_8S.html#a61723cd2f668c45cc83ab7dab81734d0">00077</a>   <a class="code" href="boot_8S.html#afb62e42d422f503bfc9d7ea1ce028702">add</a>  $(<a class="code" href="boot_8S.html#ae4045f33f677b81f6047a39fc9053e71">INT_WRAPPER_END</a>-<a class="code" href="boot_8S.html#ab59b207d7128ace888297774731b86d3">INT_WRAPPER_START</a>), %<a class="code" href="boot_8S.html#af8c3dad903dc5ce31f1b569dc396f91a">ebx</a>         <span class="comment">/* Load the address of the current wrapper function */</span>
<a name="l00078"></a>00078   <a class="code" href="boot_8S.html#aed0edaf7a9f9542fe8d84e5217620080">movl</a> %<a class="code" href="boot_8S.html#af8c3dad903dc5ce31f1b569dc396f91a">ebx</a>, %ecx
<a name="l00079"></a>00079   mov  %<a class="code" href="boot_8S.html#abb847124ab91c84675cf45ea5d858807">cx</a>, (%<a class="code" href="boot_8S.html#a81cc0d72065afb3131a4f613d9bb9b12">eax</a>)      <span class="comment">/* Copy the lower bytes of the address to the IDT */</span>
<a name="l00080"></a>00080   <a class="code" href="boot_8S.html#a61723cd2f668c45cc83ab7dab81734d0">shr</a>  $16, %ecx
<a name="l00081"></a>00081   mov  %<a class="code" href="boot_8S.html#abb847124ab91c84675cf45ea5d858807">cx</a>, 6(%<a class="code" href="boot_8S.html#a81cc0d72065afb3131a4f613d9bb9b12">eax</a>)     <span class="comment">/* Copy the upper bytes of the address to the IDT */</span>
<a name="l00082"></a>00082   <a class="code" href="boot_8S.html#afb62e42d422f503bfc9d7ea1ce028702">add</a>  $8,  %<a class="code" href="boot_8S.html#a81cc0d72065afb3131a4f613d9bb9b12">eax</a>
<a name="l00083"></a>00083   <a class="code" href="o__stream_8h.html#a143762d59413d6d7cae38fb25104c5c4" title="switch basis of o_stream to decimal">dec</a>  %dx
<a name="l00084"></a>00084   jnz  .<a class="code" href="boot_8S.html#a2d3583e547158b12cf139920c005272c">loop</a>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086   lidt IDTR             <span class="comment">/* Load the IDT */</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <a class="code" href="boot_8S.html#a6d9acb0e6f8443a21f0a468870022a17">disableNMI</a>:             <span class="comment">/* Disable non-maskable interrupts */</span>
<a name="l00089"></a>00089   mov $0x80, %<a class="code" href="boot_8S.html#a120dcb1a498079e1fbb0a8e414752c9d">al</a>        <span class="comment">/* NMI verbieten */</span>
<a name="l00090"></a>00090   out %<a class="code" href="boot_8S.html#a120dcb1a498079e1fbb0a8e414752c9d">al</a>, $0x70
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <a class="code" href="boot_8S.html#a08d131fbb61d353c17f998c81f95ad03">initFPU</a>:                    <span class="comment">/* setup FPU for 486 and newer */</span>
<a name="l00093"></a>00093   pushl %<a class="code" href="boot_8S.html#a81cc0d72065afb3131a4f613d9bb9b12">eax</a>
<a name="l00094"></a>00094   mov  %CR0, %<a class="code" href="boot_8S.html#a81cc0d72065afb3131a4f613d9bb9b12">eax</a>
<a name="l00095"></a>00095   <a class="code" href="boot_8S.html#ad9262432da5399fd6224c72200dff57d">and</a>  $(-1-0x04), %<a class="code" href="boot_8S.html#a81cc0d72065afb3131a4f613d9bb9b12">eax</a>     <span class="comment">/* clear CR0.EM Bit */</span>
<a name="l00096"></a><a class="code" href="boot_8S.html#a82a2b84ec1e71d3db2ec43370c863f6c">00096</a>   <a class="code" href="boot_8S.html#a82a2b84ec1e71d3db2ec43370c863f6c">or</a>   $0x20, %<a class="code" href="boot_8S.html#a81cc0d72065afb3131a4f613d9bb9b12">eax</a>          <span class="comment">/*   set CR0.NE Bit */</span>
<a name="l00097"></a>00097   mov  %<a class="code" href="boot_8S.html#a81cc0d72065afb3131a4f613d9bb9b12">eax</a>, %CR0
<a name="l00098"></a>00098   popl %eax
<a name="l00099"></a>00099   finit                     <span class="comment">/* initialize floating point */</span>
<a name="l00100"></a>00100   fldcw fpucw_37E           <span class="comment">/* enable invalid opcode exception */</span>
<a name="l00101"></a>00101   ffree %ST(0)
<a name="l00102"></a>00102   ffree %ST(1)
<a name="l00103"></a>00103   ffree %ST(2)
<a name="l00104"></a>00104   ffree %ST(3)
<a name="l00105"></a>00105   ffree %ST(4)
<a name="l00106"></a>00106   ffree %ST(5)
<a name="l00107"></a>00107   ffree %ST(6)
<a name="l00108"></a>00108   ffree %ST(7)
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 setupObj:               <span class="comment">/* Call the constructors of global objects */</span>
<a name="l00111"></a>00111   call <a class="code" href="cppInit_8c.html#a2bb109465f27062f3de4857550737daf">constructObjects</a>
<a name="l00112"></a>00112   <span class="comment">/*ljmpl $0x04, $callKernel*/</span> <span class="comment">/* only test code: generate GP */</span>
<a name="l00113"></a>00113   <span class="comment">/*int $2*/</span>            <span class="comment">/* only test code: generate pseudo Interrupt 2, just normal interrupt, no exception generation */</span>
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 callKernel:             <span class="comment">/* Call the C/C++ main function of the operating system */</span>
<a name="l00116"></a>00116   call <a class="code" href="main_8cc.html#a796315624c9bcf31fd673cb62e4b9819" title="kernel entry point">kernel</a>
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 destroyObj:             <span class="comment">/* Call the destructors of global objects */</span>
<a name="l00119"></a>00119   call <a class="code" href="cppInit_8c.html#a911d105ea1514d507a960bdbc6a2eae3">destructObjects</a>
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 leaveKernel:            <span class="comment">/* The operating system ended, halt the CPU */</span>
<a name="l00122"></a>00122   cli
<a name="l00123"></a>00123 .halt:  hlt
<a name="l00124"></a>00124     jmp .halt
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 intWrappers:            <span class="comment">/* Create the interrupt wrappers */</span>
<a name="l00129"></a>00129   .rept 256
<a name="l00130"></a>00130     wrapperGen
<a name="l00131"></a>00131   .endr
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 callGuardian:           <span class="comment">/* Unified interrupt handling routine */</span>
<a name="l00134"></a>00134   cld                   <span class="comment">/* expected by gcc */</span>
<a name="l00135"></a>00135   
<a name="l00136"></a>00136   push %ecx             <span class="comment">/* save volatile registers */</span>
<a name="l00137"></a>00137   push %edx
<a name="l00138"></a>00138   
<a name="l00139"></a>00139   <a class="code" href="boot_8S.html#ad9262432da5399fd6224c72200dff57d">and</a>  $0xFF, %eax      <span class="comment">/* the interrupt wrapper only provides 8bit */</span>
<a name="l00140"></a>00140   cmp  $0x20, %eax
<a name="l00141"></a>00141   jb callEHandle
<a name="l00142"></a>00142   
<a name="l00143"></a>00143   push %eax             <span class="comment">/* push the argument of the C/C++ interrupt handler */</span>
<a name="l00144"></a>00144   call <a class="code" href="guardian_8cc.html#a9017cbb15c79b718e82c9ed18a58ed60" title="Entry point for interrupts.">guardian</a>         <span class="comment">/* call the interrupt handler */</span>
<a name="l00145"></a>00145   pop %eax              <span class="comment">/* cleanup */</span>
<a name="l00146"></a>00146   
<a name="l00147"></a>00147 endGuardian:
<a name="l00148"></a>00148   pop %edx              <span class="comment">/* retrieve saved registers */</span>
<a name="l00149"></a>00149   pop %ecx
<a name="l00150"></a>00150   pop %eax              <span class="comment">/* was pushed in wrapper */</span>
<a name="l00151"></a>00151   
<a name="l00152"></a>00152   iret                  <span class="comment">/* leave interrupt */</span>
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 callEHandle:
<a name="l00155"></a>00155   <span class="comment">/* identify reserved exceptions */</span>
<a name="l00156"></a>00156   cmp $0x01, %ax      
<a name="l00157"></a>00157   je callExcRHandle
<a name="l00158"></a>00158   cmp $0x0F, %ax
<a name="l00159"></a>00159   je callExcRHandle
<a name="l00160"></a>00160   cmp $0x09, %ax
<a name="l00161"></a>00161   je callExcRHandle
<a name="l00162"></a>00162   cmp $0x13, %ax
<a name="l00163"></a>00163   ja callExcRHandle
<a name="l00164"></a>00164   
<a name="l00165"></a>00165   <span class="comment">/* identify exceptions with no error code */</span>
<a name="l00166"></a>00166   cmp $0x07, %ax
<a name="l00167"></a>00167   jb callExcNHandle
<a name="l00168"></a>00168   cmp $0x10, %ax
<a name="l00169"></a>00169   je callExcNHandle
<a name="l00170"></a>00170   cmp $0x11, %ax
<a name="l00171"></a>00171   ja callExcNHandle
<a name="l00172"></a>00172   
<a name="l00173"></a>00173   <span class="comment">/* otherwise it should be a exception with error code */</span>
<a name="l00174"></a>00174   jmp callExcEHandle
<a name="l00175"></a>00175   
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 callExcNHandle:         <span class="comment">/* handle exception interrupt with no error code */</span>
<a name="l00178"></a>00178   push %ebp
<a name="l00179"></a>00179   mov %esp,%ebp
<a name="l00180"></a>00180   
<a name="l00181"></a>00181   push 20(%ebp)
<a name="l00182"></a>00182   push 24(%ebp)
<a name="l00183"></a>00183   push 16(%ebp)
<a name="l00184"></a>00184   push %eax
<a name="l00185"></a>00185   
<a name="l00186"></a>00186   <span class="comment">/*cmp $0x00, %ax</span>
<a name="l00187"></a>00187 <span class="comment">  je extraCEH*/</span>
<a name="l00188"></a>00188   
<a name="l00189"></a>00189   call <a class="code" href="guardian_8cc.html#afe78f34c7c65df79376008e0d23c1afd" title="This function is called if a normal exception is raised by the cpu.">handleException</a>
<a name="l00190"></a>00190   
<a name="l00191"></a>00191 endCEH:                 <span class="comment">/* clean up */</span>
<a name="l00192"></a>00192   add 16,%esp
<a name="l00193"></a>00193   pop %ebp
<a name="l00194"></a>00194   jmp endGuardian       <span class="comment">/* and go to clean up of guardian */</span>
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 extraCEH:
<a name="l00197"></a>00197   pushl endCEH
<a name="l00198"></a>00198   push %esp
<a name="l00199"></a>00199   push %eax
<a name="l00200"></a>00200   <span class="comment">/* call analyseException */</span>
<a name="l00201"></a>00201   pop %eax
<a name="l00202"></a>00202   pop %esp
<a name="l00203"></a>00203   pop %eax
<a name="l00204"></a>00204   jmp endCEH
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 callExcEHandle:         <span class="comment">/* handle exception interrupt with error code */</span>
<a name="l00207"></a>00207   push %ebp
<a name="l00208"></a>00208   mov %esp,%ebp
<a name="l00209"></a>00209   
<a name="l00210"></a>00210   push 16(%ebp)
<a name="l00211"></a>00211   push 24(%ebp)
<a name="l00212"></a>00212   push 28(%ebp)
<a name="l00213"></a>00213   push 20(%ebp)
<a name="l00214"></a>00214   push %eax
<a name="l00215"></a>00215   
<a name="l00216"></a>00216   call <a class="code" href="guardian_8cc.html#a70466c5bd3ffac85265c22f65e9a4ef9" title="This function is called if a normal exception with error code is raised by the cpu.">handleExceptionE</a>
<a name="l00217"></a>00217   
<a name="l00218"></a>00218   add 20,%esp
<a name="l00219"></a>00219   pop %ebp
<a name="l00220"></a>00220   jmp endGuardian
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 callExcRHandle:         <span class="comment">/* handle reserved exception interrupt */</span>
<a name="l00223"></a>00223   push %ax              <span class="comment">/* push the argument of the C/C++ interrupt handler */</span>
<a name="l00224"></a>00224   call <a class="code" href="guardian_8cc.html#a390d383038610b600ab986ec9b54879a" title="This function is called if a reserved exception is raised by the cpu.">handleExceptionReserved</a>
<a name="l00225"></a>00225   pop %ax               <span class="comment">/* cleanup */</span>
<a name="l00226"></a>00226   
<a name="l00227"></a>00227   jmp endGuardian
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 gotoAnalyse:
<a name="l00230"></a>00230   push %ebp
<a name="l00231"></a>00231   mov %esp, %ebp
<a name="l00232"></a>00232   add $8, %ebp
<a name="l00233"></a>00233   push %ebp
<a name="l00234"></a>00234   <span class="comment">/* call analyseProcedureStack */</span>
<a name="l00235"></a>00235   pop %ebp
<a name="l00236"></a>00236   pop %ebp
<a name="l00237"></a>00237   ret
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 .bss                    <span class="comment">/* the fallowing is uninitialized reserved memory */</span>
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   .comm   stack, <a class="code" href="config_8h.html#ab84fd5359aa475aeef51323866ef5d73" title="Größe für den Stack, die der Bootcode anlegen und nutzen soll.">BOOT_STACK_SIZE</a>  <span class="comment">/* memory for stack */</span>
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 .data                   <span class="comment">/* pre-initialized memory */</span>
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 fpucw_37E:
<a name="l00248"></a>00248   .<span class="keywordtype">short</span> 0x37E          <span class="comment">/* initial value for FPU */</span>
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 GDTR:                   <span class="comment">/* The gdt pseudo-register */</span>
<a name="l00251"></a>00251   .<span class="keywordtype">short</span>  3*8-1         <span class="comment">/* 3 segments, null, code, data */</span>
<a name="l00252"></a>00252   .<span class="keywordtype">int</span>  initialGDT      <span class="comment">/* start of GDT */</span>
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 IDTR:                   <span class="comment">/* The idt pseudo-register */</span>
<a name="l00255"></a>00255   .<span class="keywordtype">short</span> 256*8-1        <span class="comment">/* 256 handlers */</span>
<a name="l00256"></a>00256   .<span class="keywordtype">int</span>   initialIDT     <span class="comment">/* start if IDT */</span>
<a name="l00257"></a>00257 
<a name="l00258"></a>00258   .align 4
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 initialGDT:             <span class="comment">/* The fixed GDT for the operating system */</span>
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 nullSegment:            <span class="comment">/* Null segment as expected by x86 architecture */</span>
<a name="l00263"></a>00263   .<span class="keywordtype">short</span>  0
<a name="l00264"></a>00264   .<span class="keywordtype">short</span>  0
<a name="l00265"></a>00265   .byte 0
<a name="l00266"></a>00266   .byte 0
<a name="l00267"></a>00267   .byte 0
<a name="l00268"></a>00268   .byte 0
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 codeSegment:            <span class="comment">/* Code segment, flat memory model, read and execute */</span>
<a name="l00271"></a>00271   .<span class="keywordtype">short</span>  0xFFFF
<a name="l00272"></a>00272   .<span class="keywordtype">short</span>  0
<a name="l00273"></a>00273   .byte 0
<a name="l00274"></a>00274   .byte 0x9A
<a name="l00275"></a>00275   .byte 0xCF
<a name="l00276"></a>00276   .byte 0
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 dataSegment:            <span class="comment">/* Data segment, flat memory model, read and write */</span>
<a name="l00279"></a>00279   .<span class="keywordtype">short</span>  0xFFFF
<a name="l00280"></a>00280   .<span class="keywordtype">short</span>  0
<a name="l00281"></a>00281   .byte 0
<a name="l00282"></a>00282   .byte 0x92
<a name="l00283"></a>00283   .byte 0xCF
<a name="l00284"></a>00284   .byte 0
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 initialIDT:             <span class="comment">/* The fixed IDT for the initial protected mode setup */</span>
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 traps:                  <span class="comment">/* 32 Trap handler for CPU generated traps(, faults, interr. and aborts) */</span>
<a name="l00290"></a>00290   .rept 32
<a name="l00291"></a>00291     .<span class="keywordtype">short</span>  0
<a name="l00292"></a>00292     .<span class="keywordtype">short</span>  0x8
<a name="l00293"></a>00293     .byte 0
<a name="l00294"></a>00294     .byte 0xEF
<a name="l00295"></a>00295     .<span class="keywordtype">short</span>  0
<a name="l00296"></a>00296   .endr
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 externalInts:           <span class="comment">/* 224 interrupt handler for possibly external interrupts */</span>
<a name="l00299"></a>00299   .rept 224
<a name="l00300"></a>00300     .<span class="keywordtype">short</span>  0
<a name="l00301"></a>00301     .<span class="keywordtype">short</span>  0x8
<a name="l00302"></a>00302     .byte 0
<a name="l00303"></a>00303     .byte 0xEE
<a name="l00304"></a>00304     .<span class="keywordtype">short</span>  0
<a name="l00305"></a>00305   .endr
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Erzeugt am Mon Apr 15 2013 13:51:48 für OOStuBS - Technische Informatik II (TI-II) von &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
